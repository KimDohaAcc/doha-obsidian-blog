---
{"permalink":"/공부/기타/스크립트/","dg-publish":true,"dgPassFrontmatter":true}
---

```powershell
# System.Windows.Forms 및 System.Drawing 어셈블리 로드
Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

Add-Type -TypeDefinition @"
    using System;
    using System.Runtime.InteropServices;
    using System.Windows.Forms;
    using System.Drawing;

    public class UserActivityMonitor {
        [DllImport("user32.dll")]
        public static extern bool GetLastInputInfo(ref LASTINPUTINFO plii);

        [StructLayout(LayoutKind.Sequential)]
        public struct LASTINPUTINFO {
            public uint cbSize;
            public int dwTime;
        }

        public static int GetIdleTime() {
            LASTINPUTINFO lii = new LASTINPUTINFO();
            lii.cbSize = (uint)System.Runtime.InteropServices.Marshal.SizeOf(typeof(LASTINPUTINFO));
            GetLastInputInfo(ref lii);
            return Environment.TickCount - lii.dwTime;
        }
    }

    public class MouseMover {
        [DllImport("user32.dll", CharSet = CharSet.Auto, ExactSpelling = true)]
        public static extern bool SetCursorPos(int x, int y);

        public static void JiggleMouse() {
            Point pos = Cursor.Position;  // 마우스 현재 위치 가져오기
            SetCursorPos(pos.X + 1, pos.Y);
            System.Threading.Thread.Sleep(100);
            SetCursorPos(pos.X, pos.Y);
        }
    }
"@ -Language CSharp -ReferencedAssemblies System.Windows.Forms,System.Drawing

# 타임아웃 설정 (1시간)
$timeoutSeconds = 3600
$startTime = Get-Date
$timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"

while ($true) {
    $idleTime = [UserActivityMonitor]::GetIdleTime() / 1000  # 초 단위 변환

    if ($idleTime -ge $timeoutSeconds) {
        Write-Host "사용자 입력 없음: $timeoutSeconds 초 경과 - 스크립트 종료"
        pause
        break
    }

    # 마우스 미세 이동 (화면 꺼짐 방지)
    [MouseMover]::JiggleMouse()

	Write-Host "$timestamp wake up!"

    # 180초 대기
    Start-Sleep -Seconds 180
}


# 백그라운드 실행
Start-Process -FilePath "powershell.exe" -ArgumentList "-NoProfile -File C:\Users\Doha\OneDrive\Desktop\wakeup.ps1" -WindowStyle Hidden
```
